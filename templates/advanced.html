{% extends "base.html" %}
{% block content %}
<h2>Advanced Mode</h2>
<div class="box">
  <h3>Step 1</h3>
  <div class="button-row">
    <button id="get-ips-btn" title="Open a log file and work out what the External IP address is, and get Prowlarr IP">Get IP's</button>
  </div>
  <div id="ips-result" style="margin-top:1em;font-weight:600;"></div>
</div>
<div class="box">
  <h3>Step 2</h3>
  <div class="button-row">
    <button title="Open and Log into the Website called Myanonymouse">Log into MAM</button>
    <button title="Switch to the security page of myananamouse">View Sessions</button>
    <button title="Delete all of the old sessions">Delete old Sessions</button>
    <button title="Creates a new session for Myanonamouse qbtitorrent client that is ASN Locked and Allow Session to set Dynamic SeedBox. Copy cookie generated by Myanonamouse">Create qBittorrent Session</button>
    <button title="Creates a session for the Prowlarr Docker">Create Prowlarr Session</button>
    <button title="Logout of MAM">Logout MAM</button>
  </div>
</div>
<div class="box">
  <h3>Step 3</h3>
  <div class="button-row">
    <button title="Open a console window on the Qbittorrent docker">Log into qBittorrent</button>
    <button title="Send the cookie to qbittorrent in a command and check success">Send Cookie to qBittorrent</button>
    <button title="Logout of qBittorrent">Logout qBittorrent</button>
  </div>
</div>
<div class="box">
  <h3>Step 4</h3>
  <div class="button-row">
    <button title="Open window into the Prowlarr Docker">Log into Prowlarr</button>
    <button title="Send Prowlarr Cookie">Send Prowlarr Cookie</button>
    <button title="Logout of Prowlarr">Logout of Prowlarr</button>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const getIpsBtn = document.getElementById('get-ips-btn');
  const resultDiv = document.getElementById('ips-result');
  if (getIpsBtn) {
    getIpsBtn.addEventListener('click', function() {
      resultDiv.textContent = 'Fetching IPs...';
      fetch('/api/get_ips').then(r => r.json()).then(data => {
        let html = '';
        if (data.external_ip) {
          html += `External IP: <span style='color:#007700'>${data.external_ip}</span><br>`;
        } else {
          html += `External IP: <span style='color:#bb0000'>Not found</span><br>`;
        }
        if (data.vpn_ip) {
          html += `VPN Container IP: <span style='color:#0077bb'>${data.vpn_ip}</span>`;
        } else {
          html += `VPN Container IP: <span style='color:#bb0000'>Not found</span>`;
        }
        resultDiv.innerHTML = html;
      }).catch(() => {
        resultDiv.textContent = 'Failed to fetch IPs.';
      });
    });
  }
});
</script>
{% endblock %}
