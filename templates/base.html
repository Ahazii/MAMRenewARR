<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyAnonamouseRenewarr</title>
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="shortcut icon" href="{{ url_for('favicon') }}">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; }
        nav { margin: 1em 0; }
        .nav-link { text-decoration: none; margin: 0 1em; font-weight: bold; }
        .nav-link:hover { text-decoration: underline; }
        main { margin: 2em auto; max-width: 700px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 2em; border-radius: 8px; }
        .version { font-size: 0.9em; }
        .version a { text-decoration: none; }
        .version a:hover { text-decoration: underline; }
        .build-date { font-size: 0.75em; display: block; margin-top: 0.2em; }
        .box { border-radius: 6px; padding: 1em; margin-bottom: 1.5em; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        .config-fields { display: flex; flex-direction: column; gap: 0.7em; max-width: 430px; margin: 0 auto; }
        label { font-weight: 600; margin-bottom: 0.2em; display: inline-block; min-width: 140px; }
        input[type='text'], input[type='password'], input[type='number'], input[type='time'], select { padding: 0.4em 0.7em; border-radius: 4px; font-size: 1em; width: 260px; max-width: 100%; }
        .button-row, .box button, button {
  margin: 0.3em 0.7em 0.3em 0;
  padding: 0.55em 1.2em;
  border-radius: 5px;
  border: 1.5px solid #bbb;
  background: #f5f5f5 !important;
  color: #222 !important;
  font-weight: 600;
  font-size: 1em;
  cursor: pointer;
  transition: background 0.2s, color 0.2s, border 0.2s;
  box-shadow: 0 2px 8px rgba(120,120,120,0.08);
  letter-spacing: 0.01em;
}
.box button:hover, button:hover {
  background: #e0e0e0 !important;
  color: #111 !important;
  border-color: #888;
}
body.dark-mode .button-row, body.dark-mode .box button, body.dark-mode button {
  background: #23272b !important;
  color: #ffd700 !important;
  border: 1.5px solid #444;
}
body.dark-mode .box button:hover, body.dark-mode button:hover {
  background: #35393e !important;
  color: #fff !important;
  border-color: #ffd700;
}

        /* Light/Dark Mode Styles */
        body.light-mode { background: #f4f4f4; color: #222; }
        body.dark-mode { background: #181c1f; color: #e2e2e2; }
        body.light-mode main { background: #fff; }
        body.dark-mode main { background: #23272b; }
        body.light-mode .box { background: #f9f9f9; border-color: #ddd; }
        body.dark-mode .box { background: #23272b; border-color: #333; }
        
        /* Header and footer theme styling */
        header, footer { padding: 1em; text-align: center; }
        body.light-mode header, body.light-mode footer { background: #222; color: #fff; }
        body.dark-mode header, body.dark-mode footer { background: #111; color: #e2e2e2; }
        
        /* H1 title in header */
        body.light-mode header h1 { color: #fff; }
        body.dark-mode header h1 { color: #e2e2e2; }
        
        /* Version and build date in header */
        body.light-mode .version { color: #bbb; }
        body.dark-mode .version { color: #999; }
        body.light-mode .version a { color: #88ccff; }
        body.dark-mode .version a { color: #4db8ff; }
        body.light-mode .build-date { color: #999; }
        body.dark-mode .build-date { color: #777; }
        
        /* Navigation links */
        body.light-mode .nav-link { color: #fff; }
        body.dark-mode .nav-link { color: #ffd700; }
        
        /* Status in footer */
        body.light-mode #status { color: #fff; }
        body.dark-mode #status { color: #e2e2e2; }
        body.dark-mode label { color: #ffd700; }
        body.light-mode label { color: #333; }
        body.light-mode input, body.light-mode select { background: #fff; color: #222; border-color: #bbb; }
        body.dark-mode input, body.dark-mode select { background: #23272b; color: #e2e2e2; border-color: #444; }
        
        /* Run History and Auto-start section dark mode fixes */
        body.light-mode .run-history-box { background: #f9f9f9; color: #222; }
        body.dark-mode .run-history-box { background: #2d3135; color: #e2e2e2; }
        body.light-mode .auto-start-section { background: #f0f8ff; border-color: #b3d9ff; color: #555; }
        body.dark-mode .auto-start-section { background: #2a3540; border-color: #3d5266; color: #e2e2e2; }
        
        /* Progress log and debug boxes */
        .progress-log, .debug-info {
            margin-top: 0.5em;
            font-size: 0.9em;
            padding: 0.5em;
            border-radius: 4px;
            white-space: pre-line;
            max-height: 300px;
            overflow-y: auto;
        }
        body.light-mode .progress-log, body.light-mode .debug-info {
            color: #666;
            background: #f5f5f5;
            border: 1px solid #ddd;
        }
        body.dark-mode .progress-log, body.dark-mode .debug-info {
            color: #e2e2e2;
            background: #2d3135;
            border: 1px solid #3d3d3d;
        }
        
        /* Textarea dark mode support */
        body.light-mode textarea {
            background: #f9f9f9;
            color: #222;
            border: 1px solid #ddd;
        }
        body.dark-mode textarea {
            background: #2d3135;
            color: #e2e2e2;
            border: 1px solid #444;
        }


        .button-row { display: flex; flex-wrap: wrap; gap: 0.6em; margin-bottom: 1em; }
        
        /* Theme toggle in header */
        .header-theme-toggle {
            position: absolute;
            top: 1em;
            right: 1em;
            display: flex;
            align-items: center;
            gap: 0.5em;
        }
        .header-theme-toggle label {
            font-size: 0.85em;
            color: #bbb;
            margin: 0;
            min-width: unset;
        }
        .header-theme-toggle button {
            padding: 0.3em 0.6em;
            font-size: 1.2em;
            margin: 0;
        }
        body.dark-mode .header-theme-toggle label {
            color: #999;
        }
        header { position: relative; }
        
        /* Update notification banner */
        .update-banner {
            background: #ff9800;
            color: #fff;
            padding: 0.8em 1em;
            text-align: center;
            font-weight: 600;
            display: none;
            border-bottom: 3px solid #f57c00;
        }
        .update-banner.show {
            display: block;
        }
        .update-banner a {
            color: #fff;
            text-decoration: underline;
            font-weight: bold;
        }
        .update-banner a:hover {
            color: #ffeb3b;
        }
    </style>
</head>
<body class="light-mode">
    <div id="update-banner" class="update-banner">
        ðŸŽ‰ Update Available! <span id="update-version"></span> - 
        <a id="update-link" href="#" target="_blank">Download Now</a>
    </div>
    <header>
        <div class="header-theme-toggle">
            <label for="theme-toggle">Theme:</label>
            <button id="theme-toggle" title="Toggle light/dark mode">ðŸŒž</button>
        </div>
        <h1>MyAnonamouseRenewarr <span class="version"><a href="https://github.com/Ahazii/MAMRenewARR/releases" target="_blank" title="View releases">{{ version }}</a></span></h1>
        <div class="build-date">Built: {{ build_date }}</div>
        <div>by Ahazi</div>
        <nav>
            <a href="{{ url_for('basic') }}" class="nav-link">Basic</a> |
            <a href="{{ url_for('advanced') }}" class="nav-link">Advanced</a> |
            <a href="{{ url_for('config') }}" class="nav-link">Config</a> |
            <a href="{{ url_for('logs') }}" class="nav-link">Logs</a>
        </nav>
    </header>
    <main>
        {% block content %}{% endblock %}
    </main>
    <footer>
        <span id="status">Status area: Ready</span>
    </footer>
</body>
<script>
// Apply theme immediately before page renders (inline to avoid flash)
(function() {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.body.className = savedTheme + '-mode';
})();
</script>
<script>
// Light/Dark mode toggle
const toggleBtn = document.getElementById('theme-toggle');
function setTheme(mode) {
  document.body.classList.remove('light-mode', 'dark-mode');
  document.body.classList.add(mode+'-mode');
  localStorage.setItem('theme', mode);
  if (toggleBtn) toggleBtn.textContent = mode === 'dark' ? 'ðŸŒœ' : 'ðŸŒž';
}
function toggleTheme() {
  const current = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
  setTheme(current === 'dark' ? 'light' : 'dark');
}
window.addEventListener('DOMContentLoaded', () => {
  let mode = localStorage.getItem('theme');
  if (!mode) { mode = 'light'; }
  setTheme(mode);
  if (toggleBtn) toggleBtn.addEventListener('click', toggleTheme);
  
  // Check for updates
  checkForUpdates();
});

// Update checker
function checkForUpdates() {
  // Get update check interval from settings (default 6 hours)
  fetch('/api/settings')
    .then(r => r.json())
    .then(settings => {
      const updateCheckHours = settings.update_check_hours || 6;
      const lastCheck = localStorage.getItem('lastUpdateCheck');
      const now = Date.now();
      const checkInterval = updateCheckHours * 60 * 60 * 1000;
      
      if (lastCheck && (now - parseInt(lastCheck)) < checkInterval) {
        // Use cached result
        const cachedResult = localStorage.getItem('updateCheckResult');
        if (cachedResult) {
          const result = JSON.parse(cachedResult);
          if (result.update_available) {
            showUpdateBanner(result);
          }
        }
        return;
      }
      
      // Perform new check
      fetch('/api/check_update')
        .then(r => r.json())
        .then(data => {
          if (data.success && data.update_available) {
            showUpdateBanner(data);
          }
          // Cache the result
          localStorage.setItem('lastUpdateCheck', now.toString());
          localStorage.setItem('updateCheckResult', JSON.stringify(data));
        })
        .catch(err => {
          console.log('Update check failed:', err);
        });
    })
    .catch(err => {
      console.log('Failed to load settings for update check:', err);
    });
}

function showUpdateBanner(data) {
  const banner = document.getElementById('update-banner');
  const versionSpan = document.getElementById('update-version');
  const link = document.getElementById('update-link');
  
  if (banner && versionSpan && link) {
    // Don't add 'v' prefix - already included in latest_version from GitHub API
    versionSpan.textContent = `${data.latest_version} is now available`;
    link.href = data.release_url;
    banner.classList.add('show');
  }
}
</script>
</html>
